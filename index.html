<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Don&#39;t Starve Checklist</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;800&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main class="container">
      <h1 class="title">Don&#39;t Starve Checklist</h1>
      <section class="sections">
        <div class="panel first-autumn">
          <h2 class="panel-title">First Autumn</h2>
          <div class="panel-subtitle">Day 21 - Start of Winter<br/>Day 30 - Deerclops Appears</div>
          <div class="panel-section">
            <h3 class="panel-title">Find on Map</h3>
            <div class="panel-images">
              <div class="panel-image-wrap">
                <img
                  class="panel-image"
                  data-key="pig-king"
                  src="images/pig_king.png"
                  alt="Pig King"
                />
              </div>
              <div class="panel-image-wrap">
                <img
                  class="panel-image"
                  data-key="walrus-camp-winter"
                  src="images/walrus_camp_winter.png"
                  alt="Walrus Camp (Winter)"
                />
              </div>
              <div class="panel-image-wrap">
                <img
                  class="panel-image"
                  data-key="beefalo"
                  src="images/beefalo.png"
                  alt="Beefalo"
                />
              </div>
            </div>
          </div>
          <div class="panel-section">
            <h3 class="panel-title">Base Building</h3>
            <div class="panel-images">
              <div class="panel-image-wrap">
                <img
                  class="panel-image"
                  data-key="science-machine"
                  data-legacy-src="https://static.wikia.nocookie.net/dont-starve-game/images/f/f1/Science_Machine_Build.png/revision/latest?cb=20220330224433"
                  src="images/science_machine_build.png"
                  alt="Science Machine"
                />
              </div>
              <div class="panel-image-wrap">
                <img
                  class="panel-image"
                  data-key="firepit"
                  data-legacy-src="https://static.wikia.nocookie.net/dont-starve-game/images/8/8e/Firepit_Build.png/revision/latest?cb=20240716222427"
                  src="images/firepit_build.png"
                  alt="Firepit"
                />
              </div>
              <div class="panel-image-wrap">
                <img
                  class="panel-image"
                  data-key="crock-pot-1"
                  src="images/crock_pot_build.png"
                  alt="Crock Pot"
                />
              </div>
              <div class="panel-image-wrap">
                <img
                  class="panel-image"
                  data-key="crock-pot-2"
                  src="images/crock_pot_build.png"
                  alt="Crock Pot"
                />
              </div>
              <div class="panel-image-wrap">
                <img
                  class="panel-image"
                  data-key="ice-box"
                  data-legacy-src="https://static.wikia.nocookie.net/dont-starve-game/images/1/19/Ice_Box_Build.png/revision/latest?cb=20220331224707"
                  src="images/ice_box_build.png"
                  alt="Ice Box"
                />
              </div>
              <div class="panel-image-wrap">
                <img
                  class="panel-image"
                  data-key="ice-box-2"
                  src="images/ice_box_build.png"
                  alt="Ice Box"
                />
              </div>
              <div class="panel-image-wrap">
                <img
                  class="panel-image"
                  data-key="birdcage"
                  src="images/birdcage_build.png"
                  alt="Birdcage"
                />
              </div>
              <div class="panel-image-wrap">
                <img
                  class="panel-image"
                  data-key="drying-rack"
                  src="images/drying_rack_build.png"
                  alt="Drying Rack"
                />
              </div>
              <div class="panel-image-wrap">
                <img
                  class="panel-image"
                  data-key="alchemy-engine"
                  src="images/alchemy_engine_build.png"
                  alt="Alchemy Engine"
                />
              </div>
              <div class="panel-image-wrap">
                <img
                  class="panel-image"
                  data-key="prestihatitator"
                  src="images/prestihatitator_build.png"
                  alt="Prestihatitator"
                />
              </div>
              <div class="panel-image-wrap">
                <img
                  class="panel-image"
                  data-key="tent"
                  src="images/tent_build.png"
                  alt="Tent"
                />
              </div>
              <div class="panel-image-wrap">
                <img
                  class="panel-image"
                  data-key="lightning-rod"
                  src="images/lightning_rod_build.png"
                  alt="Lightning Rod"
                />
              </div>
              <div class="panel-image-wrap">
                <img
                  class="panel-image"
                  data-key="think-tank"
                  src="images/think_tank_build.png"
                  alt="Think Tank"
                />
              </div>
              <div class="panel-image-wrap">
                <img
                  class="panel-image"
                  data-key="pig-house"
                  src="images/pig_house_build.png"
                  alt="Pig House"
                />
              </div>
              <div class="panel-image-wrap">
                <img
                  class="panel-image"
                  data-key="beefalo-base"
                  src="images/beefalo.png"
                  alt="Beefalo"
                />
              </div>
            </div>
          </div>

          <div class="panel-section">
            <h3 class="panel-title">Personal Items</h3>
            <div class="panel-images">
              <div class="panel-image-wrap">
                <img class="panel-image" data-key="thermal-stone" src="images/thermal_stone_stage_3_build.png" alt="Thermal Stone" />
              </div>
              <div class="panel-image-wrap">
                <img class="panel-image" data-key="winter-hat-1" src="images/winter_hat.png" alt="Winter Hat" />
              </div>
              <div class="panel-image-wrap">
                <img class="panel-image" data-key="winter-hat-2" src="images/winter_hat.png" alt="Winter Hat" />
              </div>
              <div class="panel-image-wrap">
                <img class="panel-image" data-key="log-suit-1" src="images/log_suit.png" alt="Log Suit" />
              </div>
              <div class="panel-image-wrap">
                <img class="panel-image" data-key="log-suit-2" src="images/log_suit.png" alt="Log Suit" />
              </div>
              <div class="panel-image-wrap">
                <img class="panel-image" data-key="spear-1" src="images/spear.png" alt="Spear" />
              </div>
              <div class="panel-image-wrap">
                <img class="panel-image" data-key="spear-2" src="images/spear.png" alt="Spear" />
              </div>
            </div>
          </div>
        </div>
        <div class="panel kills">
          <h2 class="panel-title">Mini Bosses</h2>
          <div class="panel-images">
            <div class="panel-image-wrap">
              <img
                class="panel-image"
                data-key="spider-queen"
                data-name="Spider Queen"
                data-hp="2500"
                src="images/spider_queen.png"
                alt="Spider Queen"
              />
            </div>
            <div class="panel-image-wrap">
              <img
                class="panel-image"
                data-key="treeguard"
                data-name="Treeguard"
                data-hp="3750"
                src="images/treeguard.png"
                alt="Treeguard"
              />
            </div>
          </div>
        </div>
      </section>
    </main>
    <div class="clear-actions">
      <button id="clearButton" class="clear-button" type="button">Clear</button>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const STORAGE_PREFIX = 'dscheck_dim_';
        const storageKey = (raw) => `${STORAGE_PREFIX}${encodeURIComponent(raw)}`;

        // Auto-generate captions for Kills images using data attributes
        document.querySelectorAll('.panel.kills .panel-image-wrap').forEach((wrapElement) => {
          const imgElement = wrapElement.querySelector('.panel-image');
          if (!imgElement) return;
          const name = imgElement.getAttribute('data-name') || imgElement.alt || '';
          const hp = imgElement.getAttribute('data-hp');
          const captionHtml = hp ? `${name}<br/>❤️ ${hp}` : name;
          let caption = wrapElement.querySelector('.panel-caption');
          if (!caption) {
            caption = document.createElement('div');
            caption.className = 'panel-caption';
            wrapElement.appendChild(caption);
          }
          caption.innerHTML = captionHtml;
        });

        document.querySelectorAll('.panel-image').forEach((imageElement) => {
          const wrapper = imageElement.closest('.panel-image-wrap');
          const primaryId = imageElement.getAttribute('data-key') || imageElement.getAttribute('src');
          const legacyId = imageElement.getAttribute('data-legacy-src');

          // Restore, with migration from legacy URL-based key if present
          let saved = null;
          try {
            saved = localStorage.getItem(storageKey(primaryId));
            if (saved === null && legacyId) {
              const legacySaved = localStorage.getItem(storageKey(legacyId));
              if (legacySaved !== null) {
                saved = legacySaved;
                localStorage.setItem(storageKey(primaryId), saved);
                localStorage.removeItem(storageKey(legacyId));
              }
            }
          } catch (_) {}

          if (saved === '1') {
            imageElement.classList.add('is-dimmed');
            if (wrapper) wrapper.classList.add('is-dimmed');
          }

          // Toggle and persist on click
          imageElement.addEventListener('click', () => {
            imageElement.classList.toggle('is-dimmed');
            if (wrapper) wrapper.classList.toggle('is-dimmed');
            const isDimmed = imageElement.classList.contains('is-dimmed');
            try {
              localStorage.setItem(storageKey(primaryId), isDimmed ? '1' : '0');
            } catch (_) {}
          });
        });

        // Clear button: reset all dimmed states and remove stored values
        const clearBtn = document.getElementById('clearButton');
        if (clearBtn) {
          clearBtn.addEventListener('click', () => {
            document.querySelectorAll('.panel-image').forEach((img) => {
              img.classList.remove('is-dimmed');
              const wrap = img.closest('.panel-image-wrap');
              if (wrap) wrap.classList.remove('is-dimmed');
              const id = img.getAttribute('data-key') || img.getAttribute('src');
              try { localStorage.removeItem(storageKey(id)); } catch (_) {}
            });
          });

          // Match button width to a Crock Pot image if present
          const sizeButtonToCrockPot = () => {
            const crock = document.querySelector('.panel-image[data-key="crock-pot-1"], .panel-image[alt="Crock Pot"]');
            if (crock && clearBtn) {
              const width = crock.clientWidth;
              if (width > 0) {
                clearBtn.style.width = width + 'px';
              }
            }
          };
          sizeButtonToCrockPot();
          window.addEventListener('resize', sizeButtonToCrockPot);
        }
      });
    </script>
  </body>
</html>
